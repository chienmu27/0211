<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¸‚æ•™è‚²æœƒå ±åèˆ‡æŸ¥è©¢ç³»çµ±</title>

  <style>
    :root {
      --court-green: #2e7d32;
      --court-green-light: #4caf50;
      --shuttle-white: #ffffff;
      --sky-blue: #e3f2fd;
      --accent-yellow: #fff176;
      --btn-blue: #1e88ff;
      --btn-red: #d32f2f;
      --shadow: 0 12px 30px rgba(0,0,0,0.1);
    }

    * { box-sizing: border-box; }

    body {
      font-family: "Microsoft JhengHei", system-ui, sans-serif;
      margin: 0;
      padding: 30px 15px;
      color: #1b5e20;
      background: 
        radial-gradient(circle at 20% 20%, rgba(255,255,255,0.4) 0%, transparent 20%),
        linear-gradient(135deg, var(--sky-blue) 0%, #c8e6c9 100%);
      background-attachment: fixed;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .wrap { width: min(900px, 100%); animation: fadeIn 0.8s ease-out; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .title-container { text-align: center; margin-bottom: 25px; }

    h1 {
      margin: 0;
      font-size: clamp(18px, 4.5vw, 28px);
      background: var(--court-green);
      color: white;
      padding: 10px 30px;
      border-radius: 50px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      display: inline-flex;
      align-items: center;
      gap: 12px;
    }

    .racket-inline { width: 36px; height: 36px; animation: racketSwing 2s ease-in-out infinite; }

    @keyframes racketSwing {
      0%, 100% { transform: rotate(-15deg); }
      50% { transform: rotate(20deg); }
    }

    .nav-buttons { display: flex; justify-content: center; gap: 12px; margin-bottom: 25px; flex-wrap: wrap; }

    .btn {
      position: relative;
      padding: 12px 25px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      border: none;
      color: white;
      border-radius: 50px;
      background: linear-gradient(180deg, var(--btn-blue) 0%, #1565c0 100%);
      box-shadow: 0 6px 15px rgba(30,136,255,0.3);
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      min-width: 160px;
    }

    .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(30,136,255,0.4); }

    .btn-delete {
      background: linear-gradient(180deg, #ff5252 0%, var(--btn-red) 100%);
      box-shadow: 0 4px 10px rgba(211,47,47,0.3);
      font-size: 14px;
      padding: 8px 20px;
      margin-top: 10px;
      width: 100%;
    }

    .section {
      display: none;
      background: rgba(255, 255, 255, 0.9);
      padding: 25px;
      border-radius: 20px;
      box-shadow: var(--shadow);
      border: 2px solid white;
      backdrop-filter: blur(10px);
    }

    .active { display: block; animation: slideDown 0.5s ease-out; }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    iframe { width: 100%; height: 2500px; border: none; border-radius: 12px; background: white; }

    .search-box { padding: 10px 0 20px; border-bottom: 2px dashed #c8e6c9; margin-bottom: 20px; }

    input[type="text"] {
      padding: 12px 20px; width: 200px; border: 2px solid #ddd; border-radius: 12px;
      font-size: 16px; text-align: center; margin-right: 10px;
    }

    .result-card {
      text-align: left; background: white; padding: 20px; margin: 15px 0;
      border-radius: 15px; border-left: 8px solid var(--court-green-light);
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }

    .player-info { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px dashed #ddd; }
    .player-info:last-of-type { border-bottom: none; }

    .result-card p { margin: 5px 0; font-size: 15px; }
    .result-card strong { color: var(--court-green); }

    .loading { color: var(--court-green); font-weight: bold; padding: 20px; }

    @media (max-width: 600px) {
      input[type="text"] { width: 100%; margin-bottom: 15px; }
      .btn { width: 100%; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="title-container">
      <h1>
        <svg class="racket-inline" viewBox="0 0 64 64">
          <ellipse cx="28" cy="24" rx="14" ry="18" fill="none" stroke="white" stroke-width="4"/>
          <path d="M36 38 L52 54" stroke="white" stroke-width="6" stroke-linecap="round"/>
        </svg>
        å¸‚æ•™è‚²æœƒå ±åç³»çµ±
      </h1>
    </div>

    <div class="nav-buttons">
      <button class="btn" onclick="showSection('form-section')">å ±åè¡¨å–®</button>
      <button class="btn" onclick="showSection('search-section')">å ±åçµæœæŸ¥è©¢ / åˆªé™¤</button>
    </div>

    <div id="form-section" class="section active">
      <iframe src="https://docs.google.com/forms/d/e/1FAIpQLScazVR5wTsHqvLmj3yRu12UppwnQlRBbSDZ1hnhHbTNTKkvoQ/viewform">è¼‰å…¥ä¸­â€¦</iframe>
    </div>

    <div id="search-section" class="section">
      <div class="search-box">
        <h3>ğŸ¸ æŸ¥è©¢æˆ–åˆªé™¤å ±åè³‡æ–™</h3>
        <input type="text" id="idInput" placeholder="è¼¸å…¥èº«åˆ†è­‰å¾Œ5ç¢¼" maxlength="5" />
        <button class="btn" onclick="searchData()" style="min-width: 120px;">é–‹å§‹æŸ¥è©¢</button>
      </div>
      <div id="result-area"></div>
    </div>
  </div>

  <script>
    // è«‹ç¢ºä¿æ­¤ç¶²å€ç‚ºæœ€æ–°éƒ¨ç½²çš„ GAS ç¶²å€
    var GAS_URL = "https://script.google.com/macros/s/AKfycbzf94G3rqBrQzGJLWmIR9hx64DkyltheRGnVXN6XpXWv-Y6-9Qs9D_ghrQd-WKFQcKW/exec";

    function showSection(id) {
      document.querySelectorAll(".section").forEach((s) => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    async function searchData() {
      const idValue = document.getElementById("idInput").value.trim();
      const resultArea = document.getElementById("result-area");

      if (idValue.length !== 5) { alert("è«‹è¼¸å…¥æ­£ç¢ºçš„èº«åˆ†è­‰å¾Œ5ç¢¼"); return; }

      resultArea.innerHTML = '<p class="loading">æ­£åœ¨å ´ä¸Šå°‹æ‰¾è³‡æ–™... ğŸ¸</p>';

      try {
        const response = await fetch(`${GAS_URL}?action=search&id=${idValue}`);
        const data = await response.json();

        if (data.length === 0) {
          resultArea.innerHTML = "<p style='color:#d32f2f; font-weight:bold; padding:20px;'>æŸ¥ç„¡è³‡æ–™ã€‚</p>";
          return;
        }

        let html = "";
        data.forEach((entry) => {
          html += `<div class="result-card">
                    <p><strong>çµ„åˆ¥ï¼š</strong>${entry.group} (åºè™Ÿ: ${entry.serial})</p><hr>`;
          
          entry.players.forEach((p, idx) => {
            html += `<div class="player-info">
                      <p>é¸æ‰‹ ${idx+1}ï¼š${p.name} / ${p.unit}</p>
                      <p>èº«åˆ†è­‰ï¼š${p.id} / ç”Ÿæ—¥ï¼š${p.birthday}</p>
                    </div>`;
          });

          html += `<button class="btn btn-delete" onclick="deleteEntry('${entry.rowIndex}', '${entry.group}')">åˆªé™¤æ­¤ç­†å ±å</button>`;
          html += `</div>`;
        });

        resultArea.innerHTML = html;
      } catch (error) {
        resultArea.innerHTML = "<p style='color:#d32f2f; font-weight:bold;'>ç³»çµ±é€£ç·šç•°å¸¸ã€‚</p>";
      }
    }

    async function deleteEntry(rowIndex, groupName) {
      if (!confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${groupName}ã€çš„å ±åè³‡æ–™å—ï¼Ÿ\næ­¤å‹•ä½œç„¡æ³•é‚„åŸã€‚`)) return;

      const resultArea = document.getElementById("result-area");
      resultArea.innerHTML = '<p class="loading">æ­£åœ¨åŸ·è¡Œåˆªé™¤ä¸¦æ›´æ–°åå†Š... ğŸ¸</p>';

      try {
        const response = await fetch(`${GAS_URL}?action=delete&rowIndex=${rowIndex}`);
        const res = await response.json();

        if (res.status === "success") {
          alert("åˆªé™¤æˆåŠŸï¼");
          searchData(); // é‡æ–°æ•´ç†åˆ—è¡¨
        } else {
          alert("åˆªé™¤å¤±æ•—ï¼š" + res.message);
        }
      } catch (error) {
        alert("åˆªé™¤æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
      }
    }
  </script>
</body>
</html>
