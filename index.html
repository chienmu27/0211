<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¸‚æ•™è‚²æœƒå ±åèˆ‡æŸ¥è©¢ç³»çµ±</title>
  <style>
    /* ... ä¿æŒåŸæœ‰ CSS æ¨£å¼ ... */
    :root {
      --court-green: #2e7d32;
      --court-green-light: #4caf50;
      --shuttle-white: #ffffff;
      --sky-blue: #e3f2fd;
      --accent-yellow: #fff176;
      --btn-blue: #1e88ff;
      --btn-red: #d32f2f;
      --shadow: 0 12px 30px rgba(0,0,0,0.1);
    }
    * { box-sizing: border-box; }
    body { font-family: "Microsoft JhengHei", system-ui, sans-serif; margin: 0; padding: 30px 15px; color: #1b5e20; background: linear-gradient(135deg, var(--sky-blue) 0%, #c8e6c9 100%); background-attachment: fixed; min-height: 100vh; display: flex; justify-content: center; align-items: flex-start; }
    .wrap { width: min(900px, 100%); animation: fadeIn 0.8s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .title-container { text-align: center; margin-bottom: 25px; }
    h1 { background: var(--court-green); color: white; padding: 10px 30px; border-radius: 50px; display: inline-flex; align-items: center; gap: 12px; font-size: clamp(18px, 4.5vw, 28px); }
    .nav-buttons { display: flex; justify-content: center; gap: 12px; margin-bottom: 25px; flex-wrap: wrap; }
    .btn { padding: 12px 25px; font-size: 16px; font-weight: bold; cursor: pointer; border: none; color: white; border-radius: 50px; background: linear-gradient(180deg, var(--btn-blue) 0%, #1565c0 100%); transition: 0.3s; min-width: 160px; }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(30,136,255,0.4); }
    .btn-delete { background: linear-gradient(180deg, var(--btn-red) 0%, #b71c1c 100%); margin-top: 15px; width: 100%; min-width: auto; }
    .section { display: none; background: rgba(255, 255, 255, 0.9); padding: 25px; border-radius: 20px; box-shadow: var(--shadow); backdrop-filter: blur(10px); }
    .active { display: block; animation: slideDown 0.5s ease-out; }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    iframe { width: 100%; height: 2500px; border: none; border-radius: 12px; background: white; }
    .search-box { padding: 10px 0 20px; border-bottom: 2px dashed #c8e6c9; margin-bottom: 20px; text-align: center;}
    input[type="text"] { padding: 12px 20px; width: 200px; border: 2px solid #ddd; border-radius: 12px; font-size: 16px; text-align: center; }
    .result-card { text-align: left; background: white; padding: 20px; margin: 15px 0; border-radius: 15px; border-left: 8px solid var(--court-green-light); position: relative; }
    .result-card p { margin: 8px 0; border-bottom: 1px solid #f0f0f0; padding-bottom: 4px; }
    .result-card strong { color: var(--court-green); }
    .loading { color: var(--court-green); font-weight: bold; padding: 20px; text-align: center; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title-container">
      <h1>ğŸ¸ å¸‚æ•™è‚²æœƒå ±åç³»çµ±</h1>
    </div>

    <div class="nav-buttons">
      <button class="btn" onclick="showSection('form-section')">å ±åè¡¨å–®</button>
      <button class="btn" onclick="showSection('search-section')">æŸ¥è©¢ / åˆªé™¤å ±å</button>
    </div>

    <div id="form-section" class="section active">
      <iframe src="https://docs.google.com/forms/d/e/1FAIpQLScazVR5wTsHqvLmj3yRu12UppwnQlRBbSDZ1hnhHbTNTKkvoQ/viewform">è¼‰å…¥ä¸­â€¦</iframe>
    </div>

    <div id="search-section" class="section">
      <div class="search-box">
        <h3>ğŸ¸ å ±åè³‡æ–™ç®¡ç†</h3>
        <p>è¼¸å…¥èº«åˆ†è­‰å¾Œ5ç¢¼ï¼Œå¯æŸ¥è©¢è³‡æ–™æˆ–å–æ¶ˆå ±å</p>
        <input type="text" id="idInput" placeholder="èº«åˆ†è­‰å¾Œ5ç¢¼" maxlength="5" />
        <button class="btn" onclick="searchData()" style="min-width: 120px; margin-top:10px;">é–‹å§‹æŸ¥è©¢</button>
      </div>
      <div id="result-area"></div>
    </div>
  </div>

  <script>
    // *** é‡è¦ï¼šè«‹æ›æˆä½ éƒ¨ç½²å¾Œçš„ç¶²å€ ***
    var GAS_URL = "https://script.google.com/macros/s/AKfycbzwKnLeud64O8B-VxycfGK_D9pXm3EjAj0HLd2H81VOLViy8gA5xxIpf7RtjJ7NKhlH/exec";

    function showSection(id) {
      document.querySelectorAll(".section").forEach((s) => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    async function searchData() {
      const idValue = document.getElementById("idInput").value.trim();
      const resultArea = document.getElementById("result-area");

      if (idValue.length !== 5) {
        alert("è«‹è¼¸å…¥èº«åˆ†è­‰å¾Œ5ç¢¼");
        return;
      }

      resultArea.innerHTML = '<p class="loading">æ­£åœ¨æª¢ç´¢çƒå“¡åå–®... ğŸ¸</p>';

      try {
        const response = await fetch(`${GAS_URL}?id=${idValue}`);
        const data = await response.json();

        if (data.length === 0) {
          resultArea.innerHTML = "<p style='color:#d32f2f; text-align:center; padding:20px;'>æŸ¥ç„¡è³‡æ–™ï¼Œè«‹ç¢ºèªå¾Œ5ç¢¼æ˜¯å¦æ­£ç¢ºã€‚</p>";
          return;
        }

        let html = "";
        data.forEach((item) => {
          html += `
            <div class="result-card">
              <p><strong>å ±åé …ç›®ï¼š</strong>${item.group}</p>
              <p><strong>é¸æ‰‹å§“åï¼š</strong>${item.name}</p>
              <p><strong>æœå‹™å–®ä½ï¼š</strong>${item.unit}</p>
              <p><strong>èº«åˆ†è­‰å­—è™Ÿï¼š</strong>${item.id}</p>
              <p><strong>å‡ºç”Ÿæ—¥æœŸï¼š</strong>${item.birthday}</p>
              <button class="btn btn-delete" onclick="deleteRecord('${item.timestamp}', '${item.group}')">åˆªé™¤æ­¤ç­†å ±åé …ç›®</button>
            </div>
          `;
        });
        resultArea.innerHTML = html;
      } catch (error) {
        resultArea.innerHTML = "<p style='color:#d32f2f; text-align:center;'>é€£ç·šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</p>";
      }
    }

    async function deleteRecord(timestamp, groupName) {
      const idValue = document.getElementById("idInput").value.trim();
      if (!confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${groupName}ã€çš„å ±åè³‡æ–™å—ï¼Ÿ\nåˆªé™¤å¾Œå°‡ç„¡æ³•å¾©åŸã€‚`)) return;

      const resultArea = document.getElementById("result-area");
      resultArea.innerHTML = '<p class="loading">æ­£åœ¨å–æ¶ˆå ±åä¸¦æ•´ç†åå–®... ğŸ¸</p>';

      try {
        const response = await fetch(`${GAS_URL}?action=delete&timestamp=${encodeURIComponent(timestamp)}&id=${idValue}`);
        const res = await response.json();

        if (res.success) {
          alert("åˆªé™¤æˆåŠŸï¼");
          searchData(); // é‡æ–°æ•´ç†åˆ—è¡¨
        } else {
          alert("åˆªé™¤å¤±æ•—ï¼š" + res.message);
          searchData();
        }
      } catch (error) {
        alert("ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
        searchData();
      }
    }
  </script>
</body>
</html>
